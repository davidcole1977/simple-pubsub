module.exports=function(){function getSubscriptionCount(topic){return'undefined'==typeof subscriptions[topic]?0:Object.keys(subscriptions[topic]).length}function publish(topic,params){'undefined'!=typeof subscriptions[topic]&&0!==subscriptions[topic].length&&(params='undefined'!=typeof params?params:null,_.forOwn(subscriptions[topic],function(subscription){subscription.callback(params)}))}function createTopicIfDoesNotExist(topic){'undefined'==typeof subscriptions[topic]&&(subscriptions[topic]={})}function removeTopicIfNoSubscribers(topic){0===getSubscriptionCount(topic)&&delete subscriptions[topic]}function addSubscription(subscription){createTopicIfDoesNotExist(subscription.topic),subscriptions[subscription.topic][subscription.id]=subscription}function removeSubscription(subscription){delete subscriptions[subscription.topic][subscription.id]}function Subscription(topic,callback){this.id=_.uniqueId('sub_'),this.topic=topic,this.callback=callback,addSubscription(this)}var _=require('lodash'),subscriptions={};return Subscription.prototype.unsubscribe=function(){removeSubscription(this),removeTopicIfNoSubscribers(this.topic)},{publish:publish,Subscription:Subscription,getSubscriptionCount:getSubscriptionCount}}();